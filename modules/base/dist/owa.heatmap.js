"use strict";(self.webpackChunkowa=self.webpackChunkowa||[]).push([[18],{804:(t,e,o)=>{o.r(e),o.d(e,{Heatmap:()=>r});var s=o(841),a=o(755);
/**
 * Javascript Heatmap Library
 * 
 * @author      Peter Adams <peter@openwebanalytics.com>
 * @web            <a href="http://www.openwebanalytcs.com">Open Web Analytics</a>
 * @copyright   Copyright &copy; 2006-2010 Peter Adams <peter@openwebanalytics.com>
 * @license     http://www.gnu.org/copyleft/gpl.html GPL v2.0
 */
class r{constructor(t,e){this.docDimensions=this.getDim(document),t=t||this.docDimensions.w,e=e||this.docDimensions.h,s._.debug("Canvas size: %s by %s",t,e),this.createCanvas(t,e),this.canvas=document.getElementById("owa_heatmap"),this.context=this.canvas.getContext("2d"),this.options={dotSize:12,numRegions:40,alphaIncrement:50,demoMode:!1,liveMode:!0,mapInterval:1e3,randomDataCount:200,rowsPerFetch:100,strokeRegions:!1,svgUrl:s._.getSetting("baseUrl")+"/modules/base/i/test.svg#f1",baseUrl:"",apiUrl:""},this.regions=[],this.regionsMap=[],this.regionWidth=null,this.regionHeight=null,this.dirtyRegions={},this.timer="",this.clicks="",this.nextPage=1,this.more=!0,this.lock=!1}markRegionDirty(t){t>=0?(this.dirtyRegions[t]=!0,s._.debug("marking region dirty: %s",t)):s._.debug("no region to mark dirty!")}showControlPanel(){var t=this;a("body").append('<div id="owa_overlay"></div>'),a("#owa_overlay").append('<div id="owa_overlay_logo"></div>'),a("#owa_overlay").append('<div class="owa_overlay_control" id="owa_overlay_start">Start</div>'),a("#owa_overlay_start").toggleClass("active"),a("#owa_overlay").append('<div class="owa_overlay_control" id="owa_overlay_stop">Stop</div>'),a("#owa_overlay").append('<div class="owa_overlay_control" id="owa_overlay_end">X</div>'),a("#owa_overlay_start").click((function(){t.startTimer()})),a("#owa_overlay_stop").click((function(){t.stopTimer()})),a(".owa_overlay_control").bind("click",(function(){a(".owa_overlay_control").removeClass("active"),a(this).addClass("active")})),a("#owa_overlay_end").click((function(){t.endSession()})),a(window).on("unload",(function(){s._.endOverlaySession()}))}generate(){this.showControlPanel(),this.applyBlur(),!0===this.options.liveMode?this.startTimer():this.map()}endSession(){Util.eraseCookie(s._.getSetting("ns")+"overlay",document.domain),window.close()}startTimer(){var t=this;this.timer=setInterval((function(){t.map()}),this.options.mapInterval)}stopTimer(){if(!this.timer)return!1;clearInterval(this.timer)}map(){if(1!=this.lock)if(this.lock=!0,!0===this.options.liveMode)if(!0===this.checkForMoreClicks()){s._.debug("there are more clicks to fetch.");this.getData()}else s._.debug("there are no more clicks to fetch."),this.stopTimer();else this.getData();else s._.debug("skipping data fetch due to lock.")}getData(){if(!0===this.options.demoMode)return this.getRandomData(this.options.randomDataCount);this.fetchData(this.getNextPage())}checkForMoreClicks(){return this.more}getNextPage(){return this.nextPage}setNextPage(t){s._.debug("setNextpage received page as %d",t),this.nextPage++,s._.debug("setNextpage is setting page as %d",this.nextPage)}setMore(t){this.more=t}fetchData(t){if(s._.debug("fetchData will fetch page %s",t),1!=t)var e=this.clicks.next;else{var i=unescape(s._.state.getStateFromCookie("overlay"));e=JSON.parse(i).api_url}s._.debug("fetch data using api url: "+e);var o=this;a.ajax({url:e,dataType:"jsonp",jsonp:"owa_jsonpCallback",success:function(t){o.plotClickData(t)}})}plotClickData(t){return!!t&&(this.clicks=t.data,!0===t.data.more&&null!=t.data.more?(s._.debug("plotClickData says more flag was set to true"),this.setMore(!0),this.setNextPage(t.data.page)):(s._.debug("plotClickData says more flag was set to false"),this.setMore(!1)),this.plotDotsRound(this.getClicks()),this.lock=!1,!0)}getClicks(){return this.clicks.resultsRows}getRegion(t){return this.regions[t]}setColor(t){s._.debug("About to set color for region %s",t);var e=this.getRegion(t);s._.debug("set color coords %s %s",e.x,e.y);for(var i=this.context.getImageData(e.x,e.y,this.regionWidth,this.regionHeight),o=i.data,a=0,n=o.length;a<n;a+=4){var r=this.getRgbFromAlpha(o[a+3]);o[a]=Math.round(parseInt(r.r)),o[a+1]=Math.round(parseInt(r.g)),o[a+2]=Math.round(parseInt(r.b))}this.context.putImageData(i,e.x,e.y)}getRgbFromAlpha(t){var e=0,i={r:null,g:null,b:null};return t<=255&&t>=235?(e=255-t,i.r=255-e,i.g=12*e):t<=234&&t>=200?(e=234-t,i.r=255-8*e,i.g=255):t<=199&&t>=150?(e=199-t,i.g=255,i.b=5*e):t<=149&&t>=100?(e=149-t,i.g=255-5*e,i.b=255):i.b=255,i}fillRegion(t){this.fillRectangle(this.regions[t].x,this.regions[t].y,this.regionWidth,this.regionHeight,"rgba(0,0,0, 0.5)")}strokeRegion(t){this.context.strokeRect(this.regions[t].x,this.regions[t].y,this.regionWidth,this.regionHeight)}fillRectangle(t,e,i,o,s){this.context.fillStyle=s,this.context.fillRect(t,e,i,o)}fillAllRegions(){for(var t=0,e=this.regions.length;t<e;t++)this.fillRegion(t)}findRegion(t,e){for(i in t=parseFloat(t),e=parseFloat(e),s._.debug("finding region for %s",t,e),this.regionsMap)if(this.regionsMap.hasOwnProperty(i)&&(s._.debug("regionmap i: %s",i),t<=i))for(n in s._.debug("regionmap x chosen: %s. x was: %s",i,t),this.regionsMap[i])if(this.regionsMap[i].hasOwnProperty(n)&&e<=n)return s._.debug("stopping on regionmap y: %s",n),s._.debug("regionmap y: %s",n),s._.debug("region chosen: %s (i = %s, n = %s)",this.regionsMap[i][n],i,n),this.regionsMap[i][n]}calcRegions(){this.regionWidth=Math.round(this.docDimensions.w/this.options.numRegions*100)/100,this.regionHeight=Math.round(this.docDimensions.h/this.options.numRegions*100)/100,s._.debug("Region dims: %s %s",this.regionWidth,this.regionHeight);for(var t=0,e=this.regionHeight,i=this.docDimensions.h;e<=i;e+=this.regionHeight){e=Math.round(100*e)/100-0,s._.debug("calcregions y value",e);for(var o=this.regionWidth,a=this.docDimensions.w;o<=a;o+=this.regionWidth)o=Math.round(100*o)/100-0,this.regions[t]={x:o-this.regionWidth,y:e-this.regionHeight},this.regionsMap[o]||(this.regionsMap[o]=Array()),this.regionsMap[o][e]=t,!0===this.options.strokeRegions&&this.strokeRegion(t),t++}}getRandomData(t){for(var e=Array(),i=0;i<t;i++){var o=Math.round(Math.floor(Math.random()*(this.docDimensions.w-this.options.dotSize))),s=Math.round(Math.floor(Math.random()*(this.docDimensions.h-this.options.dotSize)));e.push({x:o,y:s})}return e}plotDotsRound(t){for(var e=0;e<t.length;e++)if(t[e].x+this.options.dotSize>this.docDimensions.w&&(t[e].x=t[e].x-this.options.dotSize),t[e].y+this.options.dotSize>this.docDimensions.h&&(t[e].y=t[e].y-this.options.dotSize),t[e].x<=this.docDimensions.w&&t[e].y<=this.docDimensions.h)if(s._.debug("plotting %s %s",t[e].x,t[e].y),t[e].x>=0&&t[e].y>=0){s._.debug("plotting %s %s",t[e].x,t[e].y);var i=this.context.createRadialGradient(t[e].x,t[e].y,7,t[e].x,t[e].y,this.options.dotSize);i.addColorStop(0,"rgba(0,0,0,0.1)"),i.addColorStop(1,"rgba(0,0,0,0)"),this.context.fillStyle=i,this.context.fillRect(t[e].x-this.options.dotSize,t[e].y-this.options.dotSize,2*this.options.dotSize,2*this.options.dotSize),this.setColorForDot(t[e].x,t[e].y)}else s._.debug("not getting image data. coordinates %s %s less than zero.",t[e].x,t[e].y);else s._.debug("not getting image data. coordinates %s %s are outside the canvas",t[e].x,t[e].y)}setColorForDot(t,e){s._.debug("About to set color for %s, %s",t,e);var i=1.3*this.options.dotSize;t-=i,e-=i;var o=this.docDimensions.w,a=this.docDimensions.h,n=2*this.options.dotSize;t+n>o&&(t=o-n),t<0&&(t=0),e<0&&(e=0),e+n>a&&(e=a-n);for(var r=this.context.getImageData(t,e,n,n),h=r.data,g=0,d=h.length;g<d;g+=4){var l=this.getRgbFromAlpha(h[g+3]);h[g]=Math.round(parseInt(l.r)),h[g+1]=Math.round(parseInt(l.g)),h[g+2]=Math.round(parseInt(l.b))}this.context.putImageData(r,t,e)}processDirtyRegions(){for(i in this.dirtyRegions)this.dirtyRegions.hasOwnProperty(i)&&this.setColor(i);this.dirtyRegions=new Array}applyBlur(){this.canvas.className="owa_blur"}getDocHeight(){var t=document;return Math.max(Math.max(t.body.scrollHeight,t.documentElement.scrollHeight),Math.max(t.body.offsetHeight,t.documentElement.offsetHeight),Math.max(t.body.clientHeight,t.documentElement.clientHeight))}getDim(t){var e,i,o=200,a=200;return t.height,t.body&&(t.body.scrollHeight&&(a=e=t.body.scrollHeight,o=t.body.scrollWidth),t.body.offsetHeight&&(a=i=t.body.offsetHeight,o=t.body.offsetWidth),e&&i&&(a=Math.max(e,i))),a=this.getDocHeight(),s._.debug("doc dims %s %s",o,a),{w:o,h:a}}createCanvas(t,e){a("body").append('<canvas id="owa_heatmap" width="'+t+'px" height="'+e+'px" style="position:absolute; top:0px; left:0px; z-index:999999;padding:0; margin:0;background: rgba(127, 127, 127, 0.5);"></canvas>')}getDataPoints(){}}}}]);